<div class="container-lg">
  <div class="topic-show">

    <div class="row topic-title">

      <div class="col-md-3 col-5 text-center">
        <%= attachment_image_tag(@topic, :image, size: "120x120", fallback: "no_image.jpg") %>
      </div>

      <div class="col-md-9 col-7">

        <div class="row">
          <div class="col-12 title">
            <%= @topic.title %>
          </div>
        </div>

        <div class="row">
          <div class="col-md-5 col-sm-12 col-12 topic-comment-count">
            <span class="fas fa-comment-dots"> <%= @topic.comments.count %></span>
            <span class="fas fa-shoe-prints"><%= @topic.impressionist_count %></span>
            <span><%= @topic.created_at.strftime('%Y/%m/%d %H:%M') %></span>
          </div>
          <div class="col-md-7 col-sm-12 col-12 comment-to mt-3 mt-md-0">
            <%= link_to "コメントする", '#comment-form', class: "btn btn-lg btn-white" %>
          </div>
        </div>

        <% if user_signed_in? %>
          <% if current_user.id == @topic.user_id%>
            <div class="row justify-content-end">
              <%= link_to "編集する", edit_topic_path(@topic), class: "btn btn-primary topic-edit-btn" %>
              <%= link_to topic_path(@topic), method: :delete, class: "btn btn-danger topic-destroy-btn", data: { confirm: '削除するとコメント、関連する通知等、全て消えてしまいますがよろしいでしょうか？' } do %>
                <i class="far fa-trash-alt"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>

      </div>

    </div>

    <div class="row topic-body">
      <div class="col-12">
        <%= @topic.body %>
      </div>
    </div>

  </div>

  <div class="topic-comments">

    <div class="row">
      
      <%= paginate @comments %>

        <% @comments.each do |comment| %>
          <div class="col-12">
            <div class="comment-user">
              <%= attachment_image_tag(comment.user, :profile_image, style: "width: 60px; height: 60px; border-radius: 50%;", fallback: "no_image.jpg") %>
              <%= link_to user_path(comment.user) do %>
                <%= comment.user.name %>
              <% end %>
              <%= comment.created_at.strftime('%Y/%m/%d %H:%M') %>
            </div>
            <% if current_user == comment.user %>
              <div class="comment-destroy">
                <%= link_to topic_comment_path(comment.topic, comment), method: :delete, class: "btn btn-danger" do %>
                  <i class="far fa-trash-alt"></i>
                <% end %>
              </div>
            <% end %>
            <div class="comment-view-image">
              <%= attachment_image_tag(comment, :image, style: "width: 200px; height: 200px;") %>
            </div>
            <div class="comment-comment"><%= comment.comment %></div>
            <div class="comment-reply-button">
              <%= link_to topic_comment_path(comment.topic, comment), class: "reply-button" do %>
                <i class="fas fa-reply"> 返信する　<%= comment.replies.count %>件</i>
              <% end %>
            </div>
            <div id="favorites_buttons_<%= comment.id %>" class="comment-favorite">
              <%= render 'favorites/favorites', comment: comment %>
            </div>

            <div class="border"></div>

          </div>
        <% end %>

      <%= paginate @comments %>

    </div>

    <div class="row">
      <div class="col-12 mb-3 mb-sm-5 mb-lg-0">
        <%= form_with model:[@topic, @comment], id: "comment-form", local: true do |f| %>
          <%= f.text_area :comment, rows:'5', class: "form-control neumorphism-form", placeholder: "コメントを書く" %>

          <div class="add-image">
            <div class="fas fa-camera"></div> <%= f.attachment_field :image %>
          </div>

          <img class='image_preview' >

          <div class="row justify-content-center comment-button">
            <%= f.submit "コメントを投稿する", class: "btn btn-lg btn-white col-8" %>
          </div>
        <% end %>
      </div>
    </div>

  </div>
</div>